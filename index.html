<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>光影織藝專業估價系統</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://unpkg.com/lucide-react/dist/lucide-react.min.js"></script>

    <style>
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in {
            animation: fadeIn 0.5s ease-out forwards;
        }
    </style>
</head>
<body class="bg-gray-50">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;
        
        // 取得圖示元件
        const { 
            Calculator, Ruler, Scissors, Settings, DollarSign, RefreshCw, 
            Info, ShoppingCart, Trash2, Plus, ArrowRight, ArrowLeft, 
            FileText, Edit2, Tag, CheckSquare, Square, Printer 
        } = LucideReact;

        // UI 元件：核取方塊
        const Checkbox = ({ label, checked, onChange, isRadio = false }) => (
            <label className={`flex items-center gap-3 cursor-pointer p-3 rounded-lg border transition-all ${checked ? 'bg-blue-50 border-blue-400 text-blue-700 shadow-sm' : 'bg-white border-gray-200 text-gray-600 hover:bg-gray-50'}`}>
                <div className={`w-5 h-5 flex items-center justify-center border rounded ${checked ? 'bg-blue-500 border-blue-500' : 'bg-white border-gray-300'} ${isRadio ? 'rounded-full' : ''}`}>
                {checked && <div className={`bg-white ${isRadio ? 'w-2.5 h-2.5 rounded-full' : 'w-3 h-3 rounded-sm'}`} />}
                </div>
                <span className="text-sm font-bold">{label}</span>
                <input type="checkbox" className="hidden" checked={checked} onChange={onChange} />
            </label>
        );

        // 主應用程式
        const CurtainCalculator = () => {
            // --- 狀態管理 ---
            const [activeTab, setActiveTab] = useState('pleat'); 
            const [currentView, setCurrentView] = useState('calculator'); 

            // 基礎輸入
            const [width, setWidth] = useState(180); 
            const [height, setHeight] = useState(256); 
            const [price, setPrice] = useState(240); 
            const [multiplier, setMultiplier] = useState(2.2); 
            const [note, setNote] = useState(''); 
            const [model, setModel] = useState(''); 
            
            // 蛇行簾專用設定
            const [hookSpacing, setHookSpacing] = useState(8); 
            
            // 選項狀態
            const [mountType, setMountType] = useState('');
            const [openType, setOpenType] = useState('double');
            const [trackOp, setTrackOp] = useState('');
            const [hasArm, setHasArm] = useState(false);

            const [caiSpecs, setCaiSpecs] = useState({
                pullLeft: false, pullRight: false,
                openSingle: false, openDouble: false,
                stackLeft: false, stackRight: false
            });

            const [fabricType, setFabricType] = useState('厚布');
            const [trackType, setTrackType] = useState('M16金屬勾軌道');
            const [shapeMemory, setShapeMemory] = useState(false);
            const [stainlessHook, setStainlessHook] = useState(false);
            const [tieBack, setTieBack] = useState(false);
            const [leadWeight, setLeadWeight] = useState(false);
            
            const [cart, setCart] = useState([]);

            const [result, setResult] = useState({
                fabricWidthChi: 0, fabricWidthYard: 0, fabricCuts: 0,
                totalFabricCost: 0, sewingCost: 0, trackCost: 0,
                shapeMemoryCost: 0, hookCost: 0, tieBackCost: 0, leadCost: 0,
                totalAmount: 0, debugInfo: "",
            });

            // --- 常數定義 ---
            const TRACK_PRICES = {
                '無': 0, '九龍軟軌': 70, 'M16金屬勾軌道': 66, 'S軌免鎖天架': 54, '新鋁小': 46
            };
            const SNAKE_TRACK_PRICES = {
                '無': 0, '九龍軟軌': 120, 'M16金屬勾軌道': 100, 'S軌免鎖天
